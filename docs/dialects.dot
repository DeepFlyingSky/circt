digraph G {
  // Note: Remember to run the circt/utils/update-docs-dialects.sh script after
  // modifying this file to regenerate the .svg and .png renders of the graph.
  rankdir = TB
  splines=spline
  node [shape=box style=filled fillcolor="white"]
  nodesep=0.2 // horizontal compression
  ranksep=0.5 // vertical compression
  compound=true

  // MLIR dialects
  subgraph cluster_mlir {
    label = "Upstream MLIR";
    node [fillcolor="#beaed4"]
    SCF Affine
    subgraph cluster_std_arith_dialect {
      label = ""
      Standard Arith
    }
  }

  subgraph cluster_circt {
    label = "CIRCT"
    // CIRCT dialects
    subgraph cluster_HLS {
      label = "HLS Dialects"
    }
    Handshake [URL="https://circt.llvm.org/docs/Dialects/Handshake/"]
    Calyx [URL="https://circt.llvm.org/docs/Dialects/Calyx/"]
    FIRRTL [URL="https://circt.llvm.org/docs/Dialects/FIRRTL/"]
    StaticLogic [URL="https://circt.llvm.org/docs/Dialects/StaticLogic/"]
    MSFT [URL="https://circt.llvm.org/docs/Dialects/MSFT/"]
    ESI [URL="https://circt.llvm.org/docs/Dialects/ESI/"]
    FSM [URL="https://circt.llvm.org/docs/Dialects/FSM/"]

    subgraph cluster_RTL {
      label = "RTL dialects"
      Seq [URL="https://circt.llvm.org/docs/Dialects/Seq/"]
      HW [URL="https://circt.llvm.org/docs/Dialects/HW/"]
      SV [URL="https://circt.llvm.org/docs/Dialects/SV/"]
      Comb [URL="https://circt.llvm.org/docs/Dialects/Comb/"]
      LLHD [URL="https://circt.llvm.org/docs/Dialects/LLHD/"]
    }

    // Internal tools
    subgraph internal_tools{
      node [fillcolor="#fdc086"]
      ExportVerilog FIRRTLParser Scheduling llhd_sim PyCDE
    }
  }

  // External tools
  subgraph external_tools {
    node [shape=octagon fillcolor="#ffff99"]
    Moore Calyx_native Chisel
    Circilator [style="dashed,filled"]
  }

  // File formats
  subgraph file_formats {
    node [fillcolor="#7fc97f" shape="note"]
    VCDTrace [label=".vcd"]
    CPPFile [label=".cpp"]
    SVFile [label=".sv"]
    CapNProto [label="Cap'n Proto"]
    TCL [label=".tcl"]
    FIRFile [label=".fir"]
    SVVHDL [label=".sv/.vhd"]
    PyFile [label=".py"]
  }

  // ===== Connections =====
  // Dialect conversions
  SCF -> Calyx
  Affine -> StaticLogic [style=dashed]
  StaticLogic -> Calyx [style=dashed]
  Arith -> {Handshake Calyx} [ltail=cluster_std_arith_dialect]

  Handshake -> FIRRTL
  Calyx -> FSM [style=dashed]

  // Things that lower into a subset of the RTL-like dialects. Cluster these
  // together to avoid a massive clutter.
  {FIRRTL FSM ESI MSFT PyCDE} -> HW [lhead=cluster_RTL minlen=1]
  Seq -> SV
  HW -> LLHD
  Comb -> ExportVerilog

  // Tool flows
  Scheduling -> StaticLogic [dir=both]
  Chisel -> FIRFile
  FIRFile -> FIRRTLParser
  FIRRTLParser -> FIRRTL
  HW -> ExportVerilog
  SV -> ExportVerilog
  SVVHDL -> Moore [weight=999]
  Moore -> LLHD
  LLHD -> Circilator [style=dashed]
  HW -> Circilator [style=dashed]
  Calyx -> Calyx_native
  Calyx_native -> SVFile
  ExportVerilog -> SVFile
  Circilator -> CPPFile [style=dashed]
  {LLHD Comb HW Seq} -> llhd_sim
  llhd_sim -> VCDTrace
  ESI -> CapNProto
  MSFT -> TCL
  PyFile -> PyCDE
  PyCDE -> ESI [style=dashed]

  // ====== Some fake edges to coerce a good layout ======
  // Note: Modify these if you make changes to the above diagram, and things
  // start looking weird.
  Standard -> Scheduling [weight=999 style=invis]
  FIRFile -> PyFile [weight=999 style=invis]
  Calyx -> Calyx_native [weight=999 style=invis]
  Calyx_native -> SVVHDL [weight=999 style=invis]

  // Fix the following sink nodes below the CIRCT cluster
  llhd_sim -> SVFile [weight=999 style=invis]
  llhd_sim -> Circilator [weight=999 style=invis]
  llhd_sim -> TCL [weight=999 style=invis]
  llhd_sim -> CapNProto [weight=999 style=invis]
}
